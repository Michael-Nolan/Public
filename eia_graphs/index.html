<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>

    <style>
        html {
            scroll-behavior: smooth;
        }

        .radio-options {
            display: flex;
        }
        .radio-container {
            margin: 10px;
        }
        .radio-container2 {
            margin: 10px;
        }
        .radio-container3 {
            margin: 10px;
        }
    </style>
</head>

<body>
    <div id="intro">
        <h1>US Electricity Graphs</h1>
        <br>
        <p>
            The US Energy Information Agency provides monthly data on US electricity generation.
            This site uses that data and provides some graphs to make it easier to visualize whats happening.
            If there are any other graphs you would like to see, open an issue at
            https://github.com/Michael-Nolan/Public
        </p>

    </div>
    <div class="radio-options">
        <div class="radio-container">
            <h3>Select a Group By option:</h3>

            <div class="option">
                <input type="radio" id="category-option1" name="category" value="All Sources"
                    onchange="handleSelection(this)">
                <label for="category-option1">All Sources</label>
            </div>

            <div class="option">
                <input type="radio" id="category-option2" name="category" value="Fossil Fuel & Carbon Free"
                    onchange="handleSelection(this)">
                <label for="category-option2">Fossil Fuel & Carbon Free</label>
            </div>

            <div class="option">
                <input type="radio" id="category-option3" name="category" value="Fossil Fuel, Nuclear, Renewables"
                    onchange="handleSelection(this)">
                <label for="category-option3">Fossil Fuel, Nuclear, Renewables</label>
            </div>
        </div>
        <div class="radio-container2">
            <h3>Select a Lookback option:</h3>
            <p>Lookback only effects Growth Charts</p>

            <div class="option">
                <input type="radio" id="lookback-option1" name="lookback" value="1 Month Lookback"
                    onchange="handleLookbackSelection(this)">
                <label for="lookback-option1">1 Month Lookback</label>
            </div>

            <div class="option">
                <input type="radio" id="lookback-option2" name="lookback" value="12 Month Lookback"
                    onchange="handleLookbackSelection(this)">
                <label for="lookback-option2">12 Month Lookback</label>
            </div>
        </div>
        <div class="radio-container3">
            <h3>Select a Rolling option:</h3>

            <div class="option">
                <input type="radio" id="rolling-option1" name="rolling" value="1 Month rolling"
                    onchange="handleRollingSelection(this)">
                <label for="rolling-option1">1 Month rolling</label>
            </div>

            <div class="option">
                <input type="radio" id="rolling-option2" name="rolling" value="12 Month rolling"
                    onchange="handleRollingSelection(this)">
                <label for="rolling-option2">12 Month rolling</label>
            </div>
        </div>
    </div>


    <div id="result" class="result">
        <p>You selected Group By: <span id="selected-option">All Sources</span></p>
    </div>
        <div id="result2" class="result2">
        <p>You selected: <span id="selected-option2">12 Month Lookback</span></p>
    </div>
        <div id="result3" class="result3">
        <p>You selected: <span id="selected-option3">12 Month Rolling</span></p>
    </div>
    <div>
        <strong>Jump to:</strong>
        <ul>
            <li><a href="#plotNetGenRollingDiv"> Net Generation</a></li>
            <li><a href="#plotPercentGenRollingDiv"> Percent Generation</a></li>
            <li><a href="#plotPercentGrowthDiv"> Percent Generation Growth</a></li>
            <li><a href="#plotAbsoluteGrowthDiv"> Absolute Generation Growth</a></li>
        </ul>
    </div>


    <div id="plotNetGenDiv" style="display: flex; justify-content: center;"></div>
    <div id="plotPercentGenDiv" style="display: flex; justify-content: center;"></div>
    <div id="plotPercentGrowthDiv" style="display: flex; justify-content: center;"></div>
    <div id="plotAbsoluteGrowthDiv" style="display: flex; justify-content: center;"></div>


    <div>
        <h2 style="display: flex; justify-content: center;">This is a simple naive forecast that just projects the current growth forward 5 years.</h2>
        <ul id="CAGR"></ul>
        <div id="plotForecastDiv" style="display: flex; justify-content: center;"></div>
    </div>
    



    <!-- Link the external JavaScript file containing data -->
    <script type="text/javascript" src="data.js" defer></script>
    <script type="text/javascript" src="eia.js" defer></script>
    <script>


        let lookbackWindow = 12; // Options are 1 or 12.
        let rollingWindow = 12; // Options are 1 or 12.
        let data = null;

        function handleSelection(radioButton) {
            // Update the result div
            document.getElementById("selected-option").textContent = radioButton.value;
            document.getElementById("result").style.display = "block";

            switch (radioButton.id) {
                case "category-option1":
                    data = allSourceData;
                    break;
                case "category-option2":
                    data = twoSourceData;
                    break;
                case "category-option3":
                    data = threeSourceData;
                    break;
            }
            plotAll();
        }

        function handleLookbackSelection(radioButton) {
            document.getElementById("selected-option2").textContent = radioButton.value;
            document.getElementById("result2").style.display = "block";
            // parse numeric lookback (e.g. "12 Month Lookback" -> 12)
            const parsed = parseInt(radioButton.value, 10);
            if (!isNaN(parsed)) {
                lookbackWindow = parsed;
            } else {
                lookbackWindow = 12; // default
            }

            const selectedCategory = document.querySelector('.radio-container input[name="category"]:checked');
            if (selectedCategory) {
                handleSelection(selectedCategory);
            } else {
                plotAll();
            }

        }

        function handleRollingSelection(radioButton) {
            document.getElementById("selected-option3").textContent = radioButton.value;
            document.getElementById("result3").style.display = "block";
            // parse numeric lookback (e.g. "12 Month Lookback" -> 12)
            const parsed = parseInt(radioButton.value, 10);
            if (!isNaN(parsed)) {
                rollingWindow = parsed;
            } else {
                rollingWindow = 12; // default
            }

            const selectedCategory = document.querySelector('.radio-container input[name="category"]:checked');
            if (selectedCategory) {
                handleSelection(selectedCategory);
            } else {
                plotAll();
            }

        }


        function plotAll() {
            plotNetGen(plotNetGenDiv, convertToRolling(structuredClone(data), rollingWindow), "Net Generation by Source " + getRollingText());
            plotPercentGen(plotPercentGenDiv, convertToRolling(structuredClone(data), rollingWindow), "Percent Generation by Source " + getRollingText());
            plotPercentGrowth(plotPercentGrowthDiv, calculateGrowth(convertToRolling(structuredClone(data), rollingWindow), lookbackWindow), "Percent Growth " + getLookbackText());
            plotNetGen(plotAbsoluteGrowthDiv, calculateAbsoluteGrowth(convertToRolling(structuredClone(data), rollingWindow), lookbackWindow), "Absolute Value Growth " + getLookbackText());

            plotNetGen(plotForecastDiv, extendDataByGrowth(convertToRolling(structuredClone(data), 12), 5, lookbackWindow), "Forecasted Net Generation by Source: Based on " + (lookbackWindow == 12 ? "Year-over-Year Change in Trailing 12 Month Growth":"Monthly Change in Trailing 12 Month Growth"));
        }

        function getRollingText(){
            if (rollingWindow == 1){
                return "(Monthly)"
            }
            return "(Trailing 12 Month)"
        }

        function getLookbackText(){
            if (rollingWindow == 1 && lookbackWindow == 1){return "(Month-over-Month Growth)"}
            if (rollingWindow == 1 && lookbackWindow == 12){return "(Year-over-Year Monthly Growth)"}
            if (rollingWindow == 12 && lookbackWindow == 1){return "(Monthly Change in Trailing 12 Month)"}
            if (rollingWindow == 12 && lookbackWindow == 12){return "(Year-over-Year Change in Trailing 12 Month Growth)"}
        }


    </script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            data = allSourceData
            plotAll();
        });
    </script>
</body>

</html>